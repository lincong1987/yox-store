{"version":3,"file":"yox-store.js","sources":["../src/index.js"],"sourcesContent":["\nlet Yox\n\nexport class Store {\n\n  constructor() {\n    this.$store = new Yox()\n  }\n\n  /**\n   * 从本地存储读取，需自行实现\n   *\n   * @param {string} key 数据的 key\n   * @param {Function} callback\n   */\n  read(key, callback) {\n\n  }\n\n  /**\n   * 把数据写到本地存储\n   *\n   * @param {string} key\n   * @return {string|number|boolean} value 可以是字符串、数字、布尔，但从本地存储读取出来的都是字符串\n   */\n  write(key, value) {\n\n  }\n\n  /**\n   * 内存中的取值\n   *\n   * @param {string} key\n   * @param {?boolean} readFromStorage 如果内存没有取到值，是否从本地存储尝试取值\n   * @param {?Function} callback 如果 readFromStorage 为 true，则必须传入回调函数\n   */\n  get(key, readFromStorage, callback) {\n    let instance = this\n    let value = instance.$store.get(key)\n    if (readFromStorage) {\n      return value === undefined\n        ? instance.read(\n            key,\n            function (value) {\n              instance.set(key, value)\n              callback(value)\n            }\n          )\n        : Yox.nextTick(\n            function () {\n              callback(value)\n            }\n          )\n    }\n    return value\n  }\n\n  /**\n   * 内存中的设值\n   *\n   * @param {string} key\n   * @param {string|number|boolean} value\n   * @param {?boolean} writeToStorage 是否写到本地存储中\n   */\n  set(key, value, writeToStorage) {\n    this.$store.set(key, value)\n    if (writeToStorage) {\n      this.write(key, value)\n    }\n  }\n\n  prepend(key, data) {\n    this.$store.prepend(key, data)\n  }\n\n  append(key, data) {\n    this.$store.append(key, data)\n  }\n\n  /**\n   * 通过索引移除数组中的元素\n   *\n   * @param {string} keypath\n   * @param {number} index\n   * @return {?boolean} 是否移除成功\n   */\n  removeAt(keypath, index) {\n    return this.$store.removeAt(keypath, index)\n  }\n\n  /**\n   * 直接移除数组中的元素\n   *\n   * @param {string} keypath\n   * @param {*} item\n   * @return {?boolean} 是否移除成功\n   */\n  remove(keypath, item) {\n    return this.$store.remove(keypath, item)\n  }\n\n  increase(key, step, max) {\n    this.$store.increase(key, step, max)\n  }\n\n  decrease(key, step, min) {\n    this.$store.decrease(key, step, min)\n  }\n\n  /**\n   * 更新对象类型的数据\n   *\n   * @param {string} key\n   * @param {Object} value\n   */\n  extend(key, value) {\n    if (Yox.is.object(value)) {\n      let oldValue = this.get(key)\n      if (Yox.is.object(oldValue)) {\n        value = Yox.object.extend(\n          Yox.object.extend({}, oldValue),\n          value\n        )\n      }\n      this.set(key, value)\n    }\n  }\n\n  /**\n   * 尝试设值\n   *\n   * @param {string} key\n   * @param {string|number|boolean} value\n   * @return {Function} 返回异步回调，传入是否失败\n   */\n  setting(key, value) {\n\n    let instance = this\n    let oldValue = instance.get(key)\n    instance.set(key, value)\n\n    return function (error) {\n      if (error) {\n        instance.set(key, oldValue)\n      }\n    }\n\n  }\n\n  increasing(key, step, max) {\n\n    let instance = this\n    let oldValue = instance.get(key)\n    instance.increase(key, step, max)\n\n    return function (error) {\n      if (error) {\n        instance.set(key, oldValue)\n      }\n    }\n\n  }\n\n  decreasing(key, step, min) {\n\n    let instance = this\n    let oldValue = instance.get(key)\n    instance.decrease(key, step, min)\n\n    return function (error) {\n      if (error) {\n        instance.set(key, oldValue)\n      }\n    }\n\n  }\n\n  /**\n   * 数据监听\n   *\n   * @param {string} key\n   * @param {Function} watcher\n   * @param {boolean} immediate\n   */\n  watch(key, watcher, immediate) {\n    this.$store.watch(key, watcher, immediate)\n  }\n\n  /**\n   * 取消数据监听\n   *\n   * @param {string} key\n   * @param {Function} watcher\n   */\n  unwatch(key, watcher) {\n    this.$store.unwatch(key, watcher)\n  }\n\n  nextTick(fn) {\n    this.$store.nextTick(fn)\n  }\n\n}\n\n/**\n * 版本\n */\nexport const version = process.env.NODE_VERSION\n\n/**\n * 安装插件\n */\nexport function install(Class) {\n  Yox = Class\n}\n"],"names":["let"],"mappings":"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"}